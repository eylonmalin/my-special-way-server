"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const user_db_model_1 = require("../../models/user.db.model");
const permission_factory_1 = require("./permission-factory");
exports.NO_PERMISSION = 'not permissions to execute command';
var DBOperation;
(function (DBOperation) {
    DBOperation["CREATE"] = "CREATE";
    DBOperation["READ"] = "READ";
    DBOperation["UPDATE"] = "UPDATE";
    DBOperation["DELETE"] = "DELETE";
    DBOperation["ANY"] = "ANY";
})(DBOperation = exports.DBOperation || (exports.DBOperation = {}));
var Asset;
(function (Asset) {
    Asset["STUDENT"] = "STUDENT";
    Asset["CLASS"] = "CLASS";
    Asset["LESSON"] = "LESSON";
    Asset["MAP"] = "MAP";
    Asset["USER"] = "USER";
    Asset["ANY"] = "ANY";
})(Asset = exports.Asset || (exports.Asset = {}));
var Permission;
(function (Permission) {
    Permission["ALLOW"] = "ALLOW";
    Permission["FORBID"] = "FORBID";
    Permission["OWN"] = "OWN";
})(Permission = exports.Permission || (exports.Permission = {}));
exports.TEACHER_PERMISSION_RULES = [
    // Asset.STUDENT
    { operation: DBOperation.CREATE, asset: Asset.STUDENT, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
    { operation: DBOperation.READ, asset: Asset.STUDENT, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.UPDATE, asset: Asset.STUDENT, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.DELETE, asset: Asset.STUDENT, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
    // Asset.LESSON
    { operation: DBOperation.CREATE, asset: Asset.LESSON, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
    { operation: DBOperation.READ, asset: Asset.LESSON, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.UPDATE, asset: Asset.LESSON, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.DELETE, asset: Asset.LESSON, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
    // Asset.CLASS
    { operation: DBOperation.CREATE, asset: Asset.CLASS, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
    { operation: DBOperation.READ, asset: Asset.CLASS, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.UPDATE, asset: Asset.CLASS, role: user_db_model_1.UserRole.TEACHER, permission: Permission.OWN },
    { operation: DBOperation.DELETE, asset: Asset.CLASS, role: user_db_model_1.UserRole.TEACHER, permission: Permission.FORBID },
];
function checkAndGetBasePermission(user, op, asset) {
    let permission = Permission.FORBID;
    if (user) {
        permission = permission_factory_1.PermissionFactory.get(user).getPermission(asset, op);
    }
    if (permission === Permission.FORBID) {
        throw new Error(exports.NO_PERMISSION);
    }
    return permission;
}
exports.checkAndGetBasePermission = checkAndGetBasePermission;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2R2ZXJub3Zza3kvcHJvZ3JhbW1pbmcvbXktc3BlY2lhbC13YXkvbXktc3BlY2lhbC13YXktc2VydmVyL3NyYy9tb2R1bGVzL3Blcm1pc3Npb25zL3Blcm1pc3Npb24uaW50ZXJmYWNlLnRzIiwic291cmNlcyI6WyIvVXNlcnMvZHZlcm5vdnNreS9wcm9ncmFtbWluZy9teS1zcGVjaWFsLXdheS9teS1zcGVjaWFsLXdheS1zZXJ2ZXIvc3JjL21vZHVsZXMvcGVybWlzc2lvbnMvcGVybWlzc2lvbi5pbnRlcmZhY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw4REFBb0Q7QUFFcEQsNkRBQXVEO0FBRTFDLFFBQUEsYUFBYSxHQUFHLG9DQUFvQyxDQUFDO0FBRWxFLElBQVksV0FNWDtBQU5ELFdBQVksV0FBVztJQUNuQixnQ0FBaUIsQ0FBQTtJQUNqQiw0QkFBYSxDQUFBO0lBQ2IsZ0NBQWlCLENBQUE7SUFDakIsZ0NBQWlCLENBQUE7SUFDakIsMEJBQVcsQ0FBQTtBQUNmLENBQUMsRUFOVyxXQUFXLEdBQVgsbUJBQVcsS0FBWCxtQkFBVyxRQU10QjtBQUVELElBQVksS0FPWDtBQVBELFdBQVksS0FBSztJQUNiLDRCQUFtQixDQUFBO0lBQ25CLHdCQUFlLENBQUE7SUFDZiwwQkFBaUIsQ0FBQTtJQUNqQixvQkFBVyxDQUFBO0lBQ1gsc0JBQWEsQ0FBQTtJQUNiLG9CQUFXLENBQUE7QUFDZixDQUFDLEVBUFcsS0FBSyxHQUFMLGFBQUssS0FBTCxhQUFLLFFBT2hCO0FBRUQsSUFBWSxVQUlYO0FBSkQsV0FBWSxVQUFVO0lBQ2xCLDZCQUFlLENBQUE7SUFDZiwrQkFBaUIsQ0FBQTtJQUNqQix5QkFBVyxDQUFBO0FBQ2YsQ0FBQyxFQUpXLFVBQVUsR0FBVixrQkFBVSxLQUFWLGtCQUFVLFFBSXJCO0FBU2EsUUFBQSx3QkFBd0IsR0FBcUI7SUFDdkQsZ0JBQWdCO0lBQ2hCLEVBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQyxNQUFNLEVBQUUsS0FB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QUFFO1FBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQWEsQ0FBQyxDQUFDO0tBQ2xDO0lBQ0QsT0FBTyxVQUFVLENBQUM7QUFDdEIsQ0FBQztBQVRELDhEQVNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVc2VyUm9sZX0gZnJvbSAnLi4vLi4vbW9kZWxzL3VzZXIuZGIubW9kZWwnO1xuaW1wb3J0IHtVc2VyVG9rZW5Qcm9maWxlfSBmcm9tICcuLi8uLi9tb2RlbHMvdXNlci10b2tlbi1wcm9maWxlLm1vZGVsJztcbmltcG9ydCB7UGVybWlzc2lvbkZhY3Rvcnl9IGZyb20gJy4vcGVybWlzc2lvbi1mYWN0b3J5JztcblxuZXhwb3J0IGNvbnN0IE5PX1BFUk1JU1NJT04gPSAnbm90IHBlcm1pc3Npb25zIHRvIGV4ZWN1dGUgY29tbWFuZCc7XG5cbmV4cG9ydCBlbnVtIERCT3BlcmF0aW9uIHtcbiAgICBDUkVBVEUgPSAnQ1JFQVRFJyxcbiAgICBSRUFEID0gJ1JFQUQnLFxuICAgIFVQREFURSA9ICdVUERBVEUnLFxuICAgIERFTEVURSA9ICdERUxFVEUnLFxuICAgIEFOWSA9ICdBTlknLFxufVxuXG5leHBvcnQgZW51bSBBc3NldCB7XG4gICAgU1RVREVOVCA9ICdTVFVERU5UJyxcbiAgICBDTEFTUyA9ICdDTEFTUycsXG4gICAgTEVTU09OID0gJ0xFU1NPTicsXG4gICAgTUFQID0gJ01BUCcsXG4gICAgVVNFUiA9ICdVU0VSJyxcbiAgICBBTlkgPSAnQU5ZJyxcbn1cblxuZXhwb3J0IGVudW0gUGVybWlzc2lvbiB7XG4gICAgQUxMT1cgPSAnQUxMT1cnLFxuICAgIEZPUkJJRCA9ICdGT1JCSUQnLFxuICAgIE9XTiA9ICdPV04nLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBlcm1pc3Npb25SdWxlIHtcbiAgICBvcGVyYXRpb246IERCT3BlcmF0aW9uO1xuICAgIGFzc2V0OiBBc3NldDtcbiAgICByb2xlOiBVc2VyUm9sZTtcbiAgICBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uO1xufVxuXG5leHBvcnQgY29uc3QgIFRFQUNIRVJfUEVSTUlTU0lPTl9SVUxFUzogUGVybWlzc2lvblJ1bGVbXSA9IFtcbiAgICAvLyBBc3NldC5TVFVERU5UXG4gICAge29wZXJhdGlvbjogREJPcGVyYXRpb24uQ1JFQVRFLCBhc3NldDogQXNzZXQuU1RVREVOVCwgcm9sZTogVXNlclJvbGUuVEVBQ0hFUiwgcGVybWlzc2lvbjogUGVybWlzc2lvbi5GT1JCSUR9LFxuICAgIHtvcGVyYXRpb246IERCT3BlcmF0aW9uLlJFQUQsIGFzc2V0OiBBc3NldC5TVFVERU5ULCByb2xlOiBVc2VyUm9sZS5URUFDSEVSLCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uLk9XTn0sXG4gICAge29wZXJhdGlvbjogREJPcGVyYXRpb24uVVBEQVRFLCBhc3NldDogQXNzZXQuU1RVREVOVCwgcm9sZTogVXNlclJvbGUuVEVBQ0hFUiwgcGVybWlzc2lvbjogUGVybWlzc2lvbi5PV059LFxuICAgIHtvcGVyYXRpb246IERCT3BlcmF0aW9uLkRFTEVURSwgYXNzZXQ6IEFzc2V0LlNUVURFTlQsIHJvbGU6IFVzZXJSb2xlLlRFQUNIRVIsIHBlcm1pc3Npb246IFBlcm1pc3Npb24uRk9SQklEfSxcbiAgICAvLyBBc3NldC5MRVNTT05cbiAgICB7b3BlcmF0aW9uOiBEQk9wZXJhdGlvbi5DUkVBVEUsIGFzc2V0OiBBc3NldC5MRVNTT04sIHJvbGU6IFVzZXJSb2xlLlRFQUNIRVIsIHBlcm1pc3Npb246IFBlcm1pc3Npb24uRk9SQklEfSxcbiAgICB7b3BlcmF0aW9uOiBEQk9wZXJhdGlvbi5SRUFELCBhc3NldDogQXNzZXQuTEVTU09OLCByb2xlOiBVc2VyUm9sZS5URUFDSEVSLCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uLk9XTn0sXG4gICAge29wZXJhdGlvbjogREJPcGVyYXRpb24uVVBEQVRFLCBhc3NldDogQXNzZXQuTEVTU09OLCByb2xlOiBVc2VyUm9sZS5URUFDSEVSLCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uLk9XTn0sXG4gICAge29wZXJhdGlvbjogREJPcGVyYXRpb24uREVMRVRFLCBhc3NldDogQXNzZXQuTEVTU09OLCByb2xlOiBVc2VyUm9sZS5URUFDSEVSLCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uLkZPUkJJRH0sXG4gICAgLy8gQXNzZXQuQ0xBU1NcbiAgICB7b3BlcmF0aW9uOiBEQk9wZXJhdGlvbi5DUkVBVEUsIGFzc2V0OiBBc3NldC5DTEFTUywgcm9sZTogVXNlclJvbGUuVEVBQ0hFUiwgcGVybWlzc2lvbjogUGVybWlzc2lvbi5GT1JCSUR9LFxuICAgIHtvcGVyYXRpb246IERCT3BlcmF0aW9uLlJFQUQsIGFzc2V0OiBBc3NldC5DTEFTUywgcm9sZTogVXNlclJvbGUuVEVBQ0hFUiwgcGVybWlzc2lvbjogUGVybWlzc2lvbi5PV059LFxuICAgIHtvcGVyYXRpb246IERCT3BlcmF0aW9uLlVQREFURSwgYXNzZXQ6IEFzc2V0LkNMQVNTLCByb2xlOiBVc2VyUm9sZS5URUFDSEVSLCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uLk9XTn0sXG4gICAge29wZXJhdGlvbjogREJPcGVyYXRpb24uREVMRVRFLCBhc3NldDogQXNzZXQuQ0xBU1MsIHJvbGU6IFVzZXJSb2xlLlRFQUNIRVIsIHBlcm1pc3Npb246IFBlcm1pc3Npb24uRk9SQklEfSxcbl07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVybWlzc2lvbnMge1xuICAgIGdldFBlcm1pc3Npb24oYXNzZXQ6IEFzc2V0LCBvcDogREJPcGVyYXRpb24pOiBQZXJtaXNzaW9uO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tBbmRHZXRCYXNlUGVybWlzc2lvbih1c2VyOiBvYmplY3QgfCBVc2VyVG9rZW5Qcm9maWxlIHwgdW5kZWZpbmVkLCBvcDogREJPcGVyYXRpb24sIGFzc2V0OiBBc3NldCk6IFBlcm1pc3Npb24ge1xuICAgIGxldCBwZXJtaXNzaW9uOiBQZXJtaXNzaW9uID0gUGVybWlzc2lvbi5GT1JCSUQ7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgICAgcGVybWlzc2lvbiA9IFBlcm1pc3Npb25GYWN0b3J5LmdldCh1c2VyKS5nZXRQZXJtaXNzaW9uKGFzc2V0LCBvcCk7XG4gICAgfVxuICAgIGlmIChwZXJtaXNzaW9uID09PSBQZXJtaXNzaW9uLkZPUkJJRCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoTk9fUEVSTUlTU0lPTik7XG4gICAgfVxuICAgIHJldHVybiBwZXJtaXNzaW9uO1xufVxuIl19